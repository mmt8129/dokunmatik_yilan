<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PRO DASHBOARD</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --orange: #ff8c00; --shadow: 0 4px 15px rgba(0,0,0,0.15); }
        body { font-family: 'Inter', sans-serif; background: #f4f7f6; margin: 0; padding: 15px; color: #333; overflow-x: hidden; }
        
        /* ÃœST KARE KUTULAR */
        .top-row { display: flex; gap: 15px; margin-bottom: 15px; height: 130px; }
        .box { flex: 1; background: white; border: 1px solid var(--orange); border-radius: 15px; box-shadow: var(--shadow); padding: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; cursor: pointer; position: relative; overflow: hidden; }
        
        /* HAVA DURUMU */
        .weather-icon { font-size: 30px; margin-bottom: 5px; }
        .weather-temp { font-size: 22px; font-weight: bold; }
        .weather-desc { font-size: 11px; text-transform: uppercase; color: #777; }

        /* PÄ°YASA DÃ–NGÃœSÃœ */
		.ok-up { color: #2ecc71; font-weight: bold; margin-left: 5px; } /* YeÅŸil */
        .ok-down { color: #e74c3c; font-weight: bold; margin-left: 5px; } /* KÄ±rmÄ±zÄ± */
         .market-slider { width: 100%; height: 100%; position: relative; }
        /*.market-item { position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.5s; opacity: 0; }
        /* .market-item.active { opacity: 1; }
         .market-val { color: #2ecc71; font-weight: bold; font-size: 18px; margin-top: 5px; }

/* ANA KUTUDAKÄ° ÃœÃ‡LÃœYÃœ YAN YANA DÄ°ZER VE KAYDIRIR */
#market-slider {
    display: flex;
    align-items: center;
    overflow: hidden; /* DÄ±ÅŸarÄ± taÅŸanÄ± gizle */
    width: 100%;
    height: 100%;
}

.market-track {
    display: flex;
    white-space: nowrap;
    width: max-content; /* Ä°Ã§erik kadar geniÅŸle */
    animation: piyasaKAY 8s linear infinite; /* HÄ±zÄ± 12sn yaparak biraz serileÅŸtirdik */
}

.market-item {
    display: flex;
    align-items: center;
    padding-right: 20px; /* AralarÄ±ndaki boÅŸluk */
    flex-shrink: 0; /* SÄ±kÄ±ÅŸmalarÄ±nÄ± engelle */
}

@keyframes piyasaKAY {
    0% { transform: translateX(0); } /* En baÅŸtan baÅŸla */
    100% { transform: translateX(-50%); } /* YarÄ±ya kadar kay (ikiz kopya sayesinde kesilmez) */
}

/* YENÄ°LEME BUTONU POZÄ°SYONU */
/*#market-slider { position: relative; } /* ÃœstÃ¼ne eklenecek buton iÃ§in temel */
/* .piyasa-yenile-btn {
   /* position: absolute;
   /* right: 5px;
   /* bottom: 5px;
   /* font-size: 14px;
   /* background: rgba(255,255,255,0.7);
   /* border-radius: 50%;
   /* width: 22px;
   /* height: 22px;
   /* display: flex;
   /* align-items: center;
   /* justify-content: center;
   /* z-index: 20;
   /* box-shadow: 0 2px 5px rgba(0,0,0,0.1);
/* }

        /* NAMAZ DÄ°KDÃ–RTGEN */
        .namaz-strip { background: white; border: 1px solid var(--orange); border-radius: 12px; box-shadow: var(--shadow); padding: 12px; display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 20px; cursor: pointer; }
        .namaz-label { font-size: 13px; font-weight: bold; color: #555; }
        .namaz-time { font-family: 'Inter', sans-serif; font-size: 30px; font-weight: 700; color: #222; letter-spacing: 2px; /* RakamlarÄ± birbirine biraz yaklaÅŸtÄ±rÄ±p tok durmasÄ±nÄ± saÄŸladÄ±k */}

        /* TURUNCU Ã‡Ä°ZGÄ° */
        .separator { height: 3px; background: linear-gradient(to right, transparent, var(--orange), transparent); margin-bottom: 20px; box-shadow: 0 2px 5px rgba(255,140,0,0.3); }

        /* HABERLER */
        .news-card { background: white; border: 1px solid var(--orange); border-radius: 12px; box-shadow: var(--shadow); display: flex; margin-bottom: 12px; overflow: hidden; height: 90px; cursor: pointer; }
        .news-img { width: 90px; height: 90px; object-fit: cover; background: #eee; }
        .news-content { flex: 1; padding: 10px; display: flex; flex-direction: column; justify-content: space-between; }
        .news-title { font-size: 13px; font-weight: bold; line-height: 1.3; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
        .news-source { font-size: 10px; color: var(--orange); font-weight: bold; }

        /* PENCERELER (MODAL) */
        .modal { display: none; position: fixed; bottom: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: flex-end; }
        .modal-content { background: white; width: 90%; max-height: 70%; border-radius: 20px 20px 0 0; border: 1px solid var(--orange); padding: 20px; box-shadow: 0 -5px 20px rgba(0,0,0,0.2); animation: slideUp 0.3s ease-out; overflow-y: auto; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .close-btn { background: var(--orange); color: white; border: none; width: 100%; padding: 12px; border-radius: 10px; font-weight: bold; margin-top: 15px; }
        .modal-list-item { padding: 18px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; font-size: 14px; font-weight: bold; }

        /* HABER DETAY */
        .news-detail-img { width: 100%; border-radius: 10px; margin-bottom: 10px; }
        .news-detail-text { font-size: 14px; line-height: 1.5; color: #444; }
        .go-site { background: #2a5298; color: white; border: none; padding: 12px; border-radius: 10px; font-weight: bold; text-decoration: none; display: block; text-align: center; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="top-row">
        <div class="box" onclick="openModal('modal-weather')">
            <div id="w-icon" class="weather-icon">â˜€ï¸</div>
            <div id="w-temp" class="weather-temp">--Â°C</div>
            <div id="w-desc" class="weather-desc">YÃ¼kleniyor</div>
        </div>
        <div class="box" onclick="openModal('modal-market')">
            <div class="market-slider" id="market-slider">
                <div class="market-item active"><span>USD/TRY</span><span class="market-val" id="slide-usd">--</span></div>
                <div class="market-item"><span>EUR/TRY</span><span class="market-val" id="slide-eur">--</span></div>
                <div class="market-item"><span>GRAM ALTIN</span><span class="market-val" id="slide-ga">--</span></div>
            </div>
        </div>
    </div>

    <div class="namaz-strip" onclick="openModal('modal-namaz')">
        <span id="n-next-name" class="namaz-label">SONRAKÄ°: --</span>
        <span id="n-next-time" class="namaz-time">--:--</span>
    </div>

    <div class="separator"></div>

    <div id="news-list"></div>

    <div id="modal-weather" class="modal"><div class="modal-content"><h3>5 GÃœNLÃœK HAVA</h3><div id="list-weather"></div><button class="close-btn" onclick="closeModal()">TAMAM</button></div></div>
    <div id="modal-market" class="modal"><div class="modal-content"><h3>TÃœM PÄ°YASALAR</h3><div id="list-market"></div><button class="close-btn" onclick="closeModal()">TAMAM</button></div></div>
    <div id="modal-namaz" class="modal"><div class="modal-content"><h3>VAKÄ°TLER</h3><div id="list-namaz"></div><button class="close-btn" onclick="closeModal()">TAMAM</button></div></div>
    <div id="modal-news" class="modal"><div class="modal-content" id="news-detail-content"></div></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAwQfifK4eaSrSjKpA776hD0RAlx_6a2_w",
            databaseURL: "https://piyasa-9049c-default-rtdb.firebaseio.com",
            projectId: "piyasa-9049c"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

       // YENÄ° HAVA DURUMU SÄ°STEMÄ° (OPEN-METEO UYUMLU)
        db.ref("hava").on("value", s => {
            const d = s.val();
            if(!d || !d.current) return;

            // Ana ekrandaki kutu
            document.getElementById('w-temp').innerText = Math.round(d.current.temperature_2m) + "Â°C";
            document.getElementById('w-desc').innerText = getWeatherDesc(d.current.weather_code);
            document.getElementById('w-icon').innerText = getWeatherEmoji(d.current.weather_code);

let listHtml = '';
            const gunAdlari = ["Pazar", "Pazartesi", "SalÄ±", "Ã‡arÅŸamba", "PerÅŸembe", "Cuma", "Cumartesi"];
            
            for(let i=0; i<5; i++) {
                let tarihObj = new Date(d.daily.time[i]);
                let gunAdi = gunAdlari[tarihObj.getDay()];
                let gun = String(tarihObj.getDate()).padStart(2, '0');
                let ay = String(tarihObj.getMonth() + 1).padStart(2, '0');
                let kisaTarih = `${gun}/${ay} ${gunAdi}`;

                // BUGÃœNÃœ VURGULA (i=0 yani ilk eleman bugÃ¼ndÃ¼r)
                let stil = (i === 0) ? 'style="background: rgba(255,140,0,0.08); border-left: 5px solid var(--orange); font-weight: bold;"' : '';

                listHtml += `
                    <div class="modal-list-item" ${stil}>
                        <span>${kisaTarih}</span>
                        <span>${getWeatherEmoji(d.daily.weather_code[i])} ${getWeatherDesc(d.daily.weather_code[i])} ${Math.round(d.daily.temperature_2m_max[i])}Â° / ${Math.round(d.daily.temperature_2m_min[i])}Â°</span>
                    </div>`;
            }
            document.getElementById('list-weather').innerHTML = listHtml;
        });

        // Hava Durumu TanÄ±mlarÄ±
        function getWeatherDesc(code) {
            const descriptions = {0:" ", 1:" ", 2:" ", 3:" ", 45:" ", 51:" ", 61:" ", 71:" ", 95:" "};
            return descriptions[code] || "AÃ§Ä±k";
        }

        // 2. PÄ°YASA DÃ–NGÃœSÃœ (3 Saniye)
  db.ref("piyasa").on("value", s => {
    const data = s.val();
    if (!data) return;

    // 1. ANA EKRANDAKÄ° KAYAN BANT
    let icerik = '';
    const anaVarliklar = [
        { ad: "DOLAR", simge: "ğŸ’²", deger: data.currency[0].Alis, fark: data.currency[0].Fark },
        { ad: "EURO", simge: "ğŸ’¶", deger: data.currency[1].Alis, fark: data.currency[1].Fark },
        { ad: "ALTIN", simge: "ğŸ”¸", deger: data.gold[0].Alis, fark: data.gold[0].Fark }
    ];

    anaVarliklar.forEach(v => {
        let ok = parseFloat(v.fark) >= 0 ? '<span class="ok-up">â–²</span>' : '<span class="ok-down">â–¼</span>';
        icerik += `<div class="market-item">${v.simge} ${v.ad}: ${v.deger} ${ok}</div>`;
    });
 
    // Ana kutuyu ikiz kopya ve YENÄ°LEME butonuyla doldur
     document.getElementById('market-slider').innerHTML = `
       <div class="market-track">${icerik}${icerik}</div>
       <div class="piyasa-yenile-btn" onclick="location.reload();">ğŸ”„</div>`;

    // 2. AÃ‡ILAN PENCERE (MODAL)
    const tamListe = [
        { n: "DOLAR", v: data.currency[0].Alis },
        { n: "EURO", v: data.currency[1].Alis },
        { n: "ONS ALTIN", v: data.gold[10].Alis },
        { n: "GRAM ALTIN", v: data.gold[0].Alis },
        { n: "Ã‡EYREK ALTIN", v: data.gold[1].Alis },
        { n: "YARIM ALTIN", v: data.gold[2].Alis },
        { n: "TAM ALTIN", v: data.gold[3].Alis },
        { n: "GÃœMÃœÅ", v: data.gold[11].Alis },
        { n: "18 AYAR ALTIN", v: data.gold[12].Alis },
        { n: "22 AYAR BÄ°LEZÄ°K", v: data.gold[13].Alis }
    ];
 
 // SADECE SAAT KALSIN, BUTONU SÄ°LDÄ°K
// TELEFONUN SAATÄ°NÄ° DEÄÄ°L, SADECE GITHUB'DAN GELEN GERÃ‡EK VERÄ° SAATÄ°NÄ° GÃ–STERÄ°R
// Hem AltÄ±n hem DÃ¶viz kÄ±smÄ±ndaki saatleri kontrol eder, hangisini bulursa onu basar
// Firebase'deki tam ismi olan "GuncellenmeZamani" olarak gÃ¼ncelledik
let guncelSaat = (data.currency && data.currency[0].GuncellenmeZamani) || "VERÄ° BEKLENÄ°YOR...";
let mHtml = `
    <div style="text-align:right; font-size:11px; color:#777; padding:8px; border-bottom:1px solid #eee;">
        Son GÃ¼ncelleme: ${guncelSaat} 
    </div>`;
    
    tamListe.forEach(item => {
        if(item.v) {
            mHtml += `
                <div class="modal-list-item">
                    <span style="font-size: 14px;">ğŸ”¹ ${item.n}</span>
                    <span style="font-weight:bold;">${item.v}</span>
                </div>`;
        }
    });
    
    document.getElementById('list-market').innerHTML = mHtml;
});

     db.ref("namaz/items/0").on("value", s => {
            const n = s.val();
            if(!n) return;

            // 1. AM/PM'den 24 Saate Ã‡evirme Fonksiyonu
            const to24h = (timeStr) => {
                let [time, modifier] = timeStr.split(' ');
                let [hours, minutes] = time.split(':');
                if (hours === '12') hours = '00';
                if (modifier === 'pm') hours = parseInt(hours, 10) + 12;
                return `${String(hours).padStart(2, '0')}:${minutes}`;
            };

            const vakitler = [
                {ad: "Ä°MSAK", saat: to24h(n.fajr)},
                {ad: "Ã–ÄLE", saat: to24h(n.dhuhr)},
                {ad: "Ä°KÄ°NDÄ°", saat: to24h(n.asr)},
                {ad: "AKÅAM", saat: to24h(n.maghrib)},
                {ad: "YATSI", saat: to24h(n.isha)}
            ];

            // 2. Aktif Vakti Bulma
            let simdi = new Date();
            let suan = String(simdi.getHours()).padStart(2, '0') + ":" + String(simdi.getMinutes()).padStart(2, '0');
            
            let aktifIndex = -1;
            for(let i = 0; i < vakitler.length; i++) {
                if(suan >= vakitler[i].saat) aktifIndex = i;
            }
            if(aktifIndex == -1) aktifIndex = 4; // Gece yarÄ±sÄ±ndan imsaÄŸa kadar yatsÄ± sayÄ±lÄ±r

            // 3. Listeyi OluÅŸturma
            let listHtml = '';
            vakitler.forEach((v, index) => {
                let stil = (index === aktifIndex) ? 'style="background: rgba(255,140,0,0.08); border-left: 5px solid var(--orange); font-weight: bold;"' : '';
                listHtml += `<div class="modal-list-item" ${stil}><span>${v.ad}</span><span class="namaz-time" style="font-size:18px">${v.saat}</span></div>`;
            });
            document.getElementById('list-namaz').innerHTML = listHtml;
            
            // Ana ekrandaki ÅŸeridi gÃ¼ncelle (SÄ±radaki vakit)
            let sonraki = vakitler[(aktifIndex + 1) % 5];
            document.getElementById('n-next-name').innerText = "SIRADAKÄ°: " + sonraki.ad;
            document.getElementById('n-next-time').innerText = sonraki.saat;
        });

        // 4. HABERLER (KARIÅIK)
        const sources = { 'haber_trt': 'TRT HABER', 'haber_cnn': 'CNN TÃœRK', 'haber_ntv': 'NTV' };
        let allNews = [];
        Object.keys(sources).forEach(k => {
            db.ref(k + "/items").on("value", s => {
                if(s.val()) {
                    const newsWithSrc = s.val().slice(0,4).map(i => ({...i, src: sources[k]}));
                    allNews = allNews.filter(x => x.src !== sources[k]).concat(newsWithSrc);
                    renderNews();
                }
            });
        });

        function renderNews() {
            const container = document.getElementById('news-list');
            container.innerHTML = '';
            allNews.forEach((n, index) => {
                const img = n.enclosure ? n.enclosure.link : (n.thumbnail || 'https://via.placeholder.com/90?text='+n.src);
                container.innerHTML += `
                    <div class="news-card" onclick="showNewsDetail(${index})">
                        <img src="${img}" class="news-img">
                        <div class="news-content">
                            <div class="news-title">${n.title}</div>
                            <div class="news-source">${n.src}</div>
                        </div>
                    </div>`;
            });
        }

        function showNewsDetail(idx) {
            const n = allNews[idx];
            const img = n.enclosure ? n.enclosure.link : (n.thumbnail || '');
            document.getElementById('news-detail-content').innerHTML = `
                <h3>${n.title}</h3>
                ${img ? `<img src="${img}" class="news-detail-img">` : ''}
                <div class="news-detail-text">${n.description || 'Haber iÃ§eriÄŸi yÃ¼klenemedi.'}</div>
                <a href="${n.link}" target="_blank" class="go-site">SÄ°TEYE GÄ°T</a>
                <button class="close-btn" onclick="closeModal()">TAMAM</button>`;
            openModal('modal-news');
        }

        // YARDIMCI FONKSÄ°YONLAR
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }
        function getWeatherEmoji(code) {
            // KodlarÄ± tek tek deÄŸil, gruplayarak en saÄŸlam emojilere yÃ¶nlendiriyoruz
            if (code == 0) return "GÃ¼neÅŸli â˜€ï¸"; 
            if (code >= 1 && code <= 3) return "Az Bulutlu â›…";
            if (code >= 45 && code <= 48) return "Sisli â˜ï¸";
            if (code >= 51 && code <= 67) return "ï¸YaÄŸmurlu â˜”"; // 67'yi burada kapsÄ±yoruz
            if (code >= 71 && code <= 86) return "FÄ±rtÄ±nalÄ± â„ï¸";
            if (code >= 95) return "â›ˆï¸";
            
            // EÄŸer hala 67 veya baÅŸka bir kodda sorun Ã§Ä±karsa diye emniyet kemeri:
            return "â˜€ï¸"; 
        }
    </script>
</body>
</html>
